{"filter":false,"title":"cume_dist2.sql","tooltip":"/examples/functions/window/cume_dist2.sql","undoManager":{"mark":44,"position":44,"stack":[[{"start":{"row":0,"column":0},"end":{"row":11,"column":2},"action":"insert","lines":["CREATE TABLE product_groups (","\tgroup_id serial PRIMARY KEY,","\tgroup_name VARCHAR (255) NOT NULL",");","","CREATE TABLE products (","\tproduct_id serial PRIMARY KEY,","\tproduct_name VARCHAR (255) NOT NULL,","\tprice DECIMAL (11, 2),","\tgroup_id INT NOT NULL,","\tFOREIGN KEY (group_id) REFERENCES product_groups (group_id)",");"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["D"],"id":3},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["R"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["O"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["P"]}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":[" "],"id":4},{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["T"]},{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["A"]},{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":["B"]}],[{"start":{"row":0,"column":5},"end":{"row":0,"column":8},"action":"remove","lines":["TAB"],"id":5},{"start":{"row":0,"column":5},"end":{"row":0,"column":10},"action":"insert","lines":["TABLE"]}],[{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"insert","lines":[" "],"id":6},{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"insert","lines":["I"]},{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"insert","lines":["F"]}],[{"start":{"row":0,"column":13},"end":{"row":0,"column":14},"action":"insert","lines":[" "],"id":7},{"start":{"row":0,"column":14},"end":{"row":0,"column":15},"action":"insert","lines":["E"]},{"start":{"row":0,"column":15},"end":{"row":0,"column":16},"action":"insert","lines":["X"]}],[{"start":{"row":0,"column":15},"end":{"row":0,"column":16},"action":"remove","lines":["X"],"id":8}],[{"start":{"row":0,"column":15},"end":{"row":0,"column":16},"action":"insert","lines":["x"],"id":9},{"start":{"row":0,"column":16},"end":{"row":0,"column":17},"action":"insert","lines":["i"]},{"start":{"row":0,"column":17},"end":{"row":0,"column":18},"action":"insert","lines":["s"]},{"start":{"row":0,"column":18},"end":{"row":0,"column":19},"action":"insert","lines":["t"]},{"start":{"row":0,"column":19},"end":{"row":0,"column":20},"action":"insert","lines":["s"]}],[{"start":{"row":0,"column":20},"end":{"row":0,"column":21},"action":"insert","lines":[" "],"id":10}],[{"start":{"row":0,"column":21},"end":{"row":0,"column":22},"action":"insert","lines":["p"],"id":11},{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"insert","lines":["r"]},{"start":{"row":0,"column":23},"end":{"row":0,"column":24},"action":"insert","lines":["o"]}],[{"start":{"row":0,"column":21},"end":{"row":0,"column":24},"action":"remove","lines":["pro"],"id":12},{"start":{"row":0,"column":21},"end":{"row":0,"column":35},"action":"insert","lines":["product_groups"]}],[{"start":{"row":0,"column":35},"end":{"row":0,"column":36},"action":"insert","lines":[";"],"id":13}],[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":14}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":36},"action":"insert","lines":["DROP TABLE IF Exists product_groups;"],"id":15}],[{"start":{"row":6,"column":35},"end":{"row":6,"column":36},"action":"remove","lines":[";"],"id":16},{"start":{"row":6,"column":34},"end":{"row":6,"column":35},"action":"remove","lines":["s"]},{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"remove","lines":["p"]},{"start":{"row":6,"column":32},"end":{"row":6,"column":33},"action":"remove","lines":["u"]},{"start":{"row":6,"column":31},"end":{"row":6,"column":32},"action":"remove","lines":["o"]},{"start":{"row":6,"column":30},"end":{"row":6,"column":31},"action":"remove","lines":["r"]},{"start":{"row":6,"column":29},"end":{"row":6,"column":30},"action":"remove","lines":["g"]},{"start":{"row":6,"column":28},"end":{"row":6,"column":29},"action":"remove","lines":["_"]}],[{"start":{"row":6,"column":28},"end":{"row":6,"column":29},"action":"insert","lines":["s"],"id":17},{"start":{"row":6,"column":29},"end":{"row":6,"column":30},"action":"insert","lines":[";"]}],[{"start":{"row":13,"column":2},"end":{"row":14,"column":0},"action":"insert","lines":["",""],"id":18},{"start":{"row":14,"column":0},"end":{"row":15,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":15,"column":0},"end":{"row":33,"column":32},"action":"insert","lines":["INSERT INTO product_groups (group_name)","VALUES","\t('Smartphone'),","\t('Laptop'),","\t('Tablet');","","INSERT INTO products (product_name, group_id,price)","VALUES","\t('Microsoft Lumia', 1, 200),","\t('HTC One', 1, 400),","\t('Nexus', 1, 500),","\t('iPhone', 1, 900),","\t('HP Elite', 2, 1200),","\t('Lenovo Thinkpad', 2, 700),","\t('Sony VAIO', 2, 700),","\t('Dell Vostro', 2, 800),","\t('iPad', 3, 700),","\t('Kindle Fire', 3, 150),","\t('Samsung Galaxy Tab', 3, 200);"],"id":19}],[{"start":{"row":0,"column":0},"end":{"row":33,"column":32},"action":"remove","lines":["DROP TABLE IF Exists product_groups;","CREATE TABLE product_groups (","\tgroup_id serial PRIMARY KEY,","\tgroup_name VARCHAR (255) NOT NULL",");","","DROP TABLE IF Exists products;","CREATE TABLE products (","\tproduct_id serial PRIMARY KEY,","\tproduct_name VARCHAR (255) NOT NULL,","\tprice DECIMAL (11, 2),","\tgroup_id INT NOT NULL,","\tFOREIGN KEY (group_id) REFERENCES product_groups (group_id)",");","","INSERT INTO product_groups (group_name)","VALUES","\t('Smartphone'),","\t('Laptop'),","\t('Tablet');","","INSERT INTO products (product_name, group_id,price)","VALUES","\t('Microsoft Lumia', 1, 200),","\t('HTC One', 1, 400),","\t('Nexus', 1, 500),","\t('iPhone', 1, 900),","\t('HP Elite', 2, 1200),","\t('Lenovo Thinkpad', 2, 700),","\t('Sony VAIO', 2, 700),","\t('Dell Vostro', 2, 800),","\t('iPad', 3, 700),","\t('Kindle Fire', 3, 150),","\t('Samsung Galaxy Tab', 3, 200);"],"id":20},{"start":{"row":0,"column":0},"end":{"row":7,"column":12},"action":"insert","lines":["SELECT","\tgroup_name,","\tAVG (price)","FROM","\tproducts","INNER JOIN product_groups USING (group_id)","GROUP BY","\tgroup_name;"]}],[{"start":{"row":0,"column":0},"end":{"row":7,"column":12},"action":"remove","lines":["SELECT","\tgroup_name,","\tAVG (price)","FROM","\tproducts","INNER JOIN product_groups USING (group_id)","GROUP BY","\tgroup_name;"],"id":21},{"start":{"row":0,"column":0},"end":{"row":10,"column":34},"action":"insert","lines":["SELECT","\tproduct_name,","\tprice,","\tgroup_name,","\tAVG (price) OVER (","\t   PARTITION BY group_name","\t)","FROM","\tproducts","\tINNER JOIN ","\t\tproduct_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":10,"column":34},"action":"remove","lines":["SELECT","\tproduct_name,","\tprice,","\tgroup_name,","\tAVG (price) OVER (","\t   PARTITION BY group_name","\t)","FROM","\tproducts","\tINNER JOIN ","\t\tproduct_groups USING (group_id);"],"id":22},{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","  price,","\tRANK () OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t)","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","  price,","\tRANK () OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t)","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":23},{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tDENSE_RANK () OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t)","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tDENSE_RANK () OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t)","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":24},{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tFIRST_VALUE (price) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS lowest_price_per_group","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":11,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tFIRST_VALUE (price) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS lowest_price_per_group","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":25},{"start":{"row":0,"column":0},"end":{"row":12,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLAST_VALUE (price) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice RANGE BETWEEN UNBOUNDED PRECEDING","\t\tAND UNBOUNDED FOLLOWING","\t) AS highest_price_per_group","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":12,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLAST_VALUE (price) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice RANGE BETWEEN UNBOUNDED PRECEDING","\t\tAND UNBOUNDED FOLLOWING","\t) AS highest_price_per_group","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":26},{"start":{"row":0,"column":0},"end":{"row":16,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLAG (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS prev_price,","\tprice - LAG (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS cur_prev_diff","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":16,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLAG (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS prev_price,","\tprice - LAG (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS cur_prev_diff","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":27},{"start":{"row":0,"column":0},"end":{"row":16,"column":43},"action":"insert","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLEAD (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS next_price,","\tprice - LEAD (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS cur_next_diff","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"]}],[{"start":{"row":0,"column":0},"end":{"row":16,"column":43},"action":"remove","lines":["SELECT","\tproduct_name,","\tgroup_name,","\tprice,","\tLEAD (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS next_price,","\tprice - LEAD (price, 1) OVER (","\t\tPARTITION BY group_name","\t\tORDER BY","\t\t\tprice","\t) AS cur_next_diff","FROM","\tproducts","INNER JOIN product_groups USING (group_id);"],"id":28},{"start":{"row":0,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["CREATE TABLE sales_stats(","    name VARCHAR(100) NOT NULL,","    year SMALLINT NOT NULL CHECK (year > 0),","    amount DECIMAL(10,2) CHECK (amount >= 0),","    PRIMARY KEY (name,year)",");",""]}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":29}],[{"start":{"row":7,"column":0},"end":{"row":20,"column":0},"action":"insert","lines":["INSERT INTO ","    sales_stats(name, year, amount)","VALUES","    ('John Doe',2018,120000),","    ('Jane Doe',2018,110000),","    ('Jack Daniel',2018,150000),","    ('Yin Yang',2018,30000),","    ('Stephane Heady',2018,200000),","    ('John Doe',2019,150000),","    ('Jane Doe',2019,130000),","    ('Jack Daniel',2019,180000),","    ('Yin Yang',2019,25000),","    ('Stephane Heady',2019,270000);",""],"id":30}],[{"start":{"row":0,"column":0},"end":{"row":1,"column":0},"action":"insert","lines":["",""],"id":31}],[{"start":{"row":0,"column":0},"end":{"row":0,"column":1},"action":"insert","lines":["d"],"id":32},{"start":{"row":0,"column":1},"end":{"row":0,"column":2},"action":"insert","lines":["r"]},{"start":{"row":0,"column":2},"end":{"row":0,"column":3},"action":"insert","lines":["o"]},{"start":{"row":0,"column":3},"end":{"row":0,"column":4},"action":"insert","lines":["p"]}],[{"start":{"row":0,"column":4},"end":{"row":0,"column":5},"action":"insert","lines":[" "],"id":33},{"start":{"row":0,"column":5},"end":{"row":0,"column":6},"action":"insert","lines":["t"]},{"start":{"row":0,"column":6},"end":{"row":0,"column":7},"action":"insert","lines":["a"]},{"start":{"row":0,"column":7},"end":{"row":0,"column":8},"action":"insert","lines":["b"]},{"start":{"row":0,"column":8},"end":{"row":0,"column":9},"action":"insert","lines":["l"]}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"insert","lines":[" "],"id":34}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"remove","lines":[" "],"id":35}],[{"start":{"row":0,"column":9},"end":{"row":0,"column":10},"action":"insert","lines":["e"],"id":36}],[{"start":{"row":0,"column":10},"end":{"row":0,"column":11},"action":"insert","lines":[" "],"id":37},{"start":{"row":0,"column":11},"end":{"row":0,"column":12},"action":"insert","lines":["i"]},{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"insert","lines":["d"]}],[{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"remove","lines":["d"],"id":38}],[{"start":{"row":0,"column":12},"end":{"row":0,"column":13},"action":"insert","lines":["f"],"id":39}],[{"start":{"row":0,"column":13},"end":{"row":0,"column":14},"action":"insert","lines":[" "],"id":40},{"start":{"row":0,"column":14},"end":{"row":0,"column":15},"action":"insert","lines":["e"]},{"start":{"row":0,"column":15},"end":{"row":0,"column":16},"action":"insert","lines":["x"]},{"start":{"row":0,"column":16},"end":{"row":0,"column":17},"action":"insert","lines":["i"]},{"start":{"row":0,"column":17},"end":{"row":0,"column":18},"action":"insert","lines":["s"]},{"start":{"row":0,"column":18},"end":{"row":0,"column":19},"action":"insert","lines":["t"]},{"start":{"row":0,"column":19},"end":{"row":0,"column":20},"action":"insert","lines":["s"]}],[{"start":{"row":0,"column":20},"end":{"row":0,"column":21},"action":"insert","lines":[" "],"id":41},{"start":{"row":0,"column":21},"end":{"row":0,"column":22},"action":"insert","lines":["s"]},{"start":{"row":0,"column":22},"end":{"row":0,"column":23},"action":"insert","lines":["a"]},{"start":{"row":0,"column":23},"end":{"row":0,"column":24},"action":"insert","lines":["l"]},{"start":{"row":0,"column":24},"end":{"row":0,"column":25},"action":"insert","lines":["e"]}],[{"start":{"row":0,"column":21},"end":{"row":0,"column":25},"action":"remove","lines":["sale"],"id":42},{"start":{"row":0,"column":21},"end":{"row":0,"column":32},"action":"insert","lines":["sales_stats"]}],[{"start":{"row":0,"column":32},"end":{"row":0,"column":33},"action":"insert","lines":[";"],"id":43}],[{"start":{"row":0,"column":0},"end":{"row":21,"column":0},"action":"remove","lines":["drop table if exists sales_stats;","CREATE TABLE sales_stats(","    name VARCHAR(100) NOT NULL,","    year SMALLINT NOT NULL CHECK (year > 0),","    amount DECIMAL(10,2) CHECK (amount >= 0),","    PRIMARY KEY (name,year)",");","","INSERT INTO ","    sales_stats(name, year, amount)","VALUES","    ('John Doe',2018,120000),","    ('Jane Doe',2018,110000),","    ('Jack Daniel',2018,150000),","    ('Yin Yang',2018,30000),","    ('Stephane Heady',2018,200000),","    ('John Doe',2019,150000),","    ('Jane Doe',2019,130000),","    ('Jack Daniel',2019,180000),","    ('Yin Yang',2019,25000),","    ('Stephane Heady',2019,270000);",""],"id":44},{"start":{"row":0,"column":0},"end":{"row":11,"column":0},"action":"insert","lines":["SELECT ","    name,","    year, ","    amount,","    CUME_DIST() OVER (","        ORDER BY amount","    ) ","FROM ","    sales_stats","WHERE ","    year = 2018;",""]}],[{"start":{"row":0,"column":0},"end":{"row":11,"column":0},"action":"remove","lines":["SELECT ","    name,","    year, ","    amount,","    CUME_DIST() OVER (","        ORDER BY amount","    ) ","FROM ","    sales_stats","WHERE ","    year = 2018;",""],"id":45},{"start":{"row":0,"column":0},"end":{"row":10,"column":0},"action":"insert","lines":["SELECT ","    name,","\tyear,","\tamount,","    CUME_DIST() OVER (","\t\tPARTITION BY year","        ORDER BY amount","    )","FROM ","    sales_stats;",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":10,"column":0},"end":{"row":10,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1637415649088,"hash":"b9b1c5ab28c250662b2a193262ef0819f7b10b40"}